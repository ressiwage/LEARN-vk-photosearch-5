# vk-photosearch
#### для чего нужен этот проект?
я создал этот проект для быстрого поиска по десяткам тысяч фотографий в своём альбоме вк.

#### как он работает?
он скачивает фотографии из альбома вк (с помощью asyncio, aiohttp), затем размечает их с помощью модели blip (до этого была microsoft/git, но она плохо справлялась), после этого трансформирует данные в вектора bag of words и помещает в хранилище annoy, после чего ищет по минимальному расстоянию до ближайшего вектора. при желании можно запустить телеграм бот, в котором будет доступен только поиск

#### стек
aiohttp, asyncio, torch, transformers, request, annoy, pyTelegramBotAPI

# использование
1. перейдите по ссылке https://vkhost.github.io/ и скопируйте токен для kate mobile (он между &token= и &expires_in) в app/config_sample.py, затем переименуйте его в app/config.py 
2. установите куду (>12.1)
3. pip install -r requirements.txt
4. python -m spacy download en_core_web_lg
5. python -m app.search_photos.main
6. сначала скачайте ссылки на файлы (1 опция), затем сами файлы (2 опция), после этого разметьте их (3 опция) и проиндексируйте (4 опция). только после этого можно совершать поиск

***при поиске используйте en-us, а не en-uk, т.к. разметка ведётся в en-us***

для разметки ***крайне желательно*** иметь gpu лучше gtx 1050

## смена модели разметки
для смены модели разметки в модуле mark_image замените chosen_marker на свой, с теми же атрибутами и методами

# использование в колабе
сохраните репозиторий как архив, загрузите в текущую директорию в колабе, скопируйте ноутбук colab.ipynb в ту же директорию и запустите первую ячейку. затем добавьте в config.py токен и смените interactive на False.

чтобы результат сохранился синхронизируйтесь с гдиском

# использование телеграм бота
1. выполните шаги из "использование"
2. замените в app/config.py tg_token на токен бота и добавьте в allowed_ids ваш юзернейм (например, если ваш id -- @myid, то allowed_ids должен выглядеть как ['myid'])
3. python -m app.tg_bot.main
4. отправьте боту команду /search

### пример поиска по моим сохранённым фотографиям

![img1](examples/scr1.jpg)

![img2](examples/scr2.jpg)

![img3](examples/scr3.jpg)

![img4](examples/scr4.jpg)

### роадмап
- ~~создать тг бота для быстрого поиска фотокарточек~~
- прикрутить эффекты cli
- сделать распознавание текста (самое сложное)